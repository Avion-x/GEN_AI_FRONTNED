<div class="page-container-header">
    <div class="title-section">
            <button class="backBtn" [routerLink]="backUrl" [disabled]="backUrl.length == 0">
                <span class="material-symbols-rounded">bug_report</span>
            </button>
            <div class="title-container">
                <h1 class="title">
                    Test Execution
                </h1>
                <!-- <h2 class="sub-title">
                    <span *ngIf="productMainCategory">{{productMainCategory.category}}-{{productMainCategory.id}}</span>
                    <span *ngIf="productSubCategory"><i class="icofont-simple-right"></i></span>
                    <span *ngIf="productSubCategory">{{productSubCategory.sub_category}}</span>
                </h2> -->
            </div>
    </div>
    
    <div class="header-right-section">
        <!-- <button class="btn" (click)="generateTestCases()">Generate Test Cases</button> -->
    </div>
</div>
<ul class="breadcrumb">
    <li *ngFor="let item of breadcrumblist">
        <button class="btn home" *ngIf="item.name == 'Home'" [routerLink]="item.url" [disabled]="item.disabled"> 
            <i class="material-symbols-rounded">home</i> 
        </button>
        <button class="btn" *ngIf="item.name !== 'Home'" [routerLink]="item.url" [disabled]="item.disabled"> {{item.name}} </button>
    </li>    
    <!-- <li><button class="btn" disabled> Devices </button></li> -->
</ul>

<div class="content-wrapper">
    <div class="content-loader" *ngIf="deviceListLoader">
        <i class="pi pi-spin pi-spinner"></i>
        <span>Loading Devices List...</span>
    </div>

    <p-dialog class="testConformationDialog" [header]="dialogTitle" [(visible)]="confirmTestTypeDialog" [modal]="true">
        
        <!-- <p-multiSelect [options]="selectedDeviceTestTypes" [(ngModel)]="selectedTestTypes" defaultLabel="Select Test Type">
            <ng-template let-test pTemplate="test">
                <div class="flex align-items-center">
                    <span>{{test.description}}</span>
                </div>
            </ng-template>
        </p-multiSelect> -->

        <!-- <div class="p-float-label primeNgField" *ngIf="selectedDeviceTestTypes">
            <p-multiSelect class="multiSelectField" [options]="selectedDeviceTestTypes" [(ngModel)]="selectedTestTypes" optionLabel="code" display="chip"></p-multiSelect>
            <label for="multiselect">Select Test Types</label>
        </div>  -->
        <h1 class="main-title">Select Test Type</h1>

        <div class="field-checkbox" *ngFor="let test of selectedDeviceTestTypes">
            <p-checkbox name="group1" [value]="test.code" [(ngModel)]="selectedTestTypes" [inputId]="test.id"></p-checkbox>
            <label [for]="test.id">{{test.description}}</label>
        </div>

        <ng-template pTemplate="footer">
            <p-button (click)="confirmTestTypeDialog=false" label="Cancel" styleClass="p-button-text"></p-button>
            <p-button *ngIf="!generateTestCasesModal" (click)="confirmTestTypeDialog=false" label="Submit" styleClass="p-button-text"></p-button>
            <p-button *ngIf="generateTestCasesModal" (click)="confirmTestTypeDialog=false" label="Generate Test Cases" styleClass="p-button-text"></p-button>
        </ng-template>
    </p-dialog>

    <div class="custom-nav-tabs-header">
        <!-- <h1 class="main-title">Tabs List</h1> -->
        <div class="nav-tabs-container">
            <button class="nav-tab btn" (click)="tabActiveIndex = 0" [ngClass]="tabActiveIndex === 0 ? 'active':''">Ready To Test Devices</button>
            <button class="nav-tab btn" (click)="tabActiveIndex = 1" [ngClass]="tabActiveIndex === 1 ? 'active':''">All Devices</button>
        </div>        
    </div>
    
    <div class="custom-nav-tabs-container">
        <p-tabView [(activeIndex)]="tabActiveIndex">
            <p-tabPanel header="Ready to test Devices">
                <div class="table-container table-selection-list">
                    <p-table #readyToTestTable [value]="readyToTestDevices" [globalFilterFields]="['product_category','sub_category','created_at','customer', 'valid_till', 'comments']">
                        <ng-template pTemplate="caption">
                            <div class="table-title-with-search">
                                <div class="title">                                    
                                        Ready To Test Devices
                                        <div class="count">{{readyToTestDevices.length}}</div>
                                </div>
                                <div class="right-section">   
                                    <div class="search-box">
                                        <i class="pi pi-search"></i>
                                        <!-- <input pInputText type="text" #filter (input)="filterData(filter.value, 'contains')" placeholder="Search keyword" /> -->
                                        <input pInputText type="text" #filter (input)="readyToTestTable.filterGlobal(filter.value, 'contains')" placeholder="Search" />
                                    </div>                                   
                                </div>
                            </div>                
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Id</th>
                                <th>Product Code</th>
                                <th>Category Name</th>
                                <th>Sub Category Name</th>
                                <th>Customer Name</th>
                                <th>Valid Till</th>
                                <th>Available Test Type</th>
                                <th style="width: 110px; min-width: 110px; max-width: 110px;"></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-device>
                            <tr>
                                <td>{{device.id}}</td>
                                <td class="td-clr-primary tb-bold">{{device.product_code}}</td>
                                <td>{{device.category_name}}</td>
                                <td>{{device.sub_category_name}}</td>
                                <td>{{device.customer_name}}</td>
                                <td>{{device.valid_till}}</td>
                                <td class="testTypesList">
                                    <div class="chip" *ngFor="let test of device.test_types">{{test.description}}</div>
                                </td>
                                <td style="width: 110px; min-width: 110px; max-width: 110px;">
                                    <button type="button" class="testNowBtn" (click)="showTestDialog(device)">
                                        Test Now
                                        <!-- <span class="material-symbols-rounded icon">more_vert</span> -->
                                    </button>                        
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="All Devices">
                <div class="content-loader" *ngIf="productsLoader">
                    <i class="pi pi-spin pi-spinner"></i>
                    <span>Loading All Devices List...</span>
                </div>
                <div class="table-container table-selection-list">

                    <p-table #allDevicesTable [value]="allDevices" [globalFilterFields]="['product_category','sub_category','created_at','customer', 'valid_till', 'comments']">
                        <ng-template pTemplate="caption">
                            <div class="table-title-with-search">
                                <div class="title">                                    
                                        All Devices
                                        <div class="count">{{allDevices.length}}</div>
                                </div>
                                <div class="right-section">   
                                    <div class="search-box">
                                        <i class="pi pi-search"></i>
                                        <!-- <input pInputText type="text" #filter (input)="filterData(filter.value, 'contains')" placeholder="Search keyword" /> -->
                                        <input pInputText type="text" #filter (input)="allDevicesTable.filterGlobal(filter.value, 'contains')" placeholder="Search" />
                                    </div>                                   
                                </div>
                            </div>                
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Id</th>
                                <th>Product Code</th>
                                <th>Category Name</th>
                                <th>Sub Category Name</th>
                                <th>Customer Name</th>
                                <th>Valid Till</th>
                                <th>Available Test Type</th>
                                <th style="width: 110px; min-width: 110px; max-width: 110px;"></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-device>
                            <tr>
                                <td>{{device.id}}</td>
                                <td class="td-clr-primary tb-bold">{{device.product_code}}</td>
                                <td>{{device.category_name}}</td>
                                <td>{{device.sub_category_name}}</td>
                                <td>{{device.customer_name}}</td>
                                <td>{{device.valid_till}}</td>
                                <td class="testTypesList">
                                    <div class="chip" *ngFor="let test of device.test_types">{{test.description}}</div>
                                    <button *ngIf="device.test_types.length == 0" type="button" class="testNowBtn" (click)="showGenerateTestcasesDialog(device)">
                                        Generate Test Cases
                                        <!-- <span class="material-symbols-rounded icon">more_vert</span> -->
                                    </button> 
                                </td>
                                <td style="width: 110px; min-width: 110px; max-width: 110px;">
                                    <button *ngIf="device.test_types.length != 0" type="button" class="testNowBtn" (click)="showTestDialog(device)">
                                        Test Now
                                        <!-- <span class="material-symbols-rounded icon">more_vert</span> -->
                                    </button>                        
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
        </p-tabView>
    </div>    
</div>