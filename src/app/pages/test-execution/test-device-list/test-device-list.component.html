<div class="page-container-header">
    <div class="title-section">
            <button class="backBtn" [routerLink]="backUrl" [disabled]="backUrl.length == 0">
                <span class="material-symbols-rounded">bug_report</span>
            </button>
            <div class="title-container">
                <h1 class="title">
                    Test Management
                </h1>
                <!-- <h2 class="sub-title">
                    <span *ngIf="productMainCategory">{{productMainCategory.category}}-{{productMainCategory.id}}</span>
                    <span *ngIf="productSubCategory"><i class="icofont-simple-right"></i></span>
                    <span *ngIf="productSubCategory">{{productSubCategory.sub_category}}</span>
                </h2> -->
            </div>
    </div>
    
    <div class="header-right-section">
        <!-- <button class="btn" (click)="generateTestCases()">Generate Test Cases</button> -->
    </div>
</div>
<ul class="breadcrumb">
    <li *ngFor="let item of breadcrumblist">
        <button class="btn home" *ngIf="item.name == 'Home'" [routerLink]="item.url" [disabled]="item.disabled"> 
            <i class="material-symbols-rounded">home</i> 
        </button>
        <button class="btn" *ngIf="item.name !== 'Home'" [routerLink]="item.url" [disabled]="item.disabled"> {{item.name}} </button>
    </li>    
    <!-- <li><button class="btn" disabled> Devices </button></li> -->
</ul>

<div class="content-wrapper">
    <div class="content-loader" *ngIf="deviceListLoader">
        <i class="pi pi-spin pi-spinner"></i>
        <span>Loading Devices List...</span>
    </div>

    <p-dialog class="testConformationDialog" [header]="dialogTitle" [(visible)]="confirmTestTypeDialog" [modal]="true">
        
        <!-- <p-multiSelect [options]="selectedDeviceTestTypes" [(ngModel)]="selectedTestTypes" defaultLabel="Select Test Type">
            <ng-template let-test pTemplate="test">
                <div class="flex align-items-center">
                    <span>{{test.description}}</span>
                </div>
            </ng-template>
        </p-multiSelect> -->

        <!-- <div class="p-float-label primeNgField" *ngIf="selectedDeviceTestTypes">
            <p-multiSelect class="multiSelectField" [options]="selectedDeviceTestTypes" [(ngModel)]="selectedTestTypes" optionLabel="code" display="chip"></p-multiSelect>
            <label for="multiselect">Select Test Types</label>
        </div>  -->
        <h1 class="main-title">Select Test Type</h1>

        <div class="field-checkbox" *ngFor="let test of selectedDeviceTestTypes">
            <p-checkbox name="group1" [value]="test.code" [(ngModel)]="selectedTestTypes" [inputId]="test.id"></p-checkbox>
            <label [for]="test.id">{{test.description}}</label>
        </div>

        <ng-template pTemplate="footer">
            <p-button (click)="confirmTestTypeDialog=false" label="Cancel" styleClass="p-button-text"></p-button>
            <p-button *ngIf="!generateTestCasesModal" (click)="confirmTestTypeDialog=false" label="Submit" styleClass="p-button-text"></p-button>
            <p-button *ngIf="generateTestCasesModal" (click)="confirmTestTypeDialog=false" label="Generate Test Cases" styleClass="p-button-text"></p-button>
        </ng-template>
    </p-dialog>

    <div class="custom-nav-tabs-header">
        <!-- <h1 class="main-title">Tabs List</h1> -->
        <div class="nav-tabs-container">
            <button class="nav-tab btn" (click)="tabActiveIndex = 0" [ngClass]="tabActiveIndex === 0 ? 'active':''">All Devices</button>
            <button class="nav-tab btn" (click)="tabActiveIndex = 1" [ngClass]="tabActiveIndex === 1 ? 'active':''">Ready To Test Devices</button>
        </div>        
    </div>
    
    <div class="custom-nav-tabs-container">
        <p-tabView [(activeIndex)]="tabActiveIndex">
            <p-tabPanel header="All Devices">
                <div class="content-loader" *ngIf="productsLoader">
                    <i class="pi pi-spin pi-spinner"></i>
                    <span>Loading All Devices List...</span>
                </div>
                <div class="table-container table-selection-list" *ngIf="!productsLoader">

                    <p-table #allDevicesTable class="selectableTable" [value]="productsData" (onFilter)="onFiltering($event)" [globalFilterFields]="['id','product_code','main_category_name','sub_category_name','customer_name', 'valid_till']">
                        <ng-template pTemplate="caption">
                            <div class="table-title-with-search">
                                <div class="title">                                    
                                        All Devices
                                        <div class="count">{{productsData.length}}</div>
                                </div>
                                <div class="right-section">   
                                    <!-- <p-columnFilter field="main_category_name" matchMode="equals" display="menu" [showMatchModes]="false"
                                        [showOperator]="false" [showAddButton]="false">
                                        <ng-template pTemplate="header">
                                            <div class="p-px-3 p-pt-3 p-pb-0">
                                                <span class="p-text-bold">Main Category</span>
                                            </div>
                                        </ng-template>
                                        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                            <p-multiSelect [ngModel]="value" [options]="productCategoryData" placeholder="Any"
                                                (onChange)="filter($event.value); selectedFilter($event.value)" optionLabel="category">
                                                <ng-template let-option pTemplate="item">
                                                    <div class="p-multiselect-representative-option">
                                                        <span class="p-ml-1">{{option.category}}</span>
                                                    </div>
                                                </ng-template>
                                            </p-multiSelect>
                                        </ng-template>
                                    </p-columnFilter>  -->
                                    <div class="filtersSection">
                                        <p-columnFilter field="main_category_name" matchMode="equals">
                                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                                <div class="filterField p-float-label p-input-icon-left">                                                    
                                                    <p-dropdown class="field" id="filter1" [ngModel]="value" [options]="productCategoryData"  placeholder="Select a Category" optionLabel="category" optionValue="category"
                                                        (onChange)="filter($event.value); getProductsSubCategory($event.value)" [showClear]="true">
                                                        <ng-template let-item pTemplate="item">
                                                            <div class="flex align-items-center">                                                        
                                                                <span>{{item.category}}</span>
                                                            </div>
                                                        </ng-template>
                                                    </p-dropdown>
                                                    <i class="pi pi-filter-fill icon"></i>
                                                    <label for="filter1">Category</label>
                                                </div>                                            
                                            </ng-template>
                                        </p-columnFilter>
    
                                        <p-columnFilter *ngIf="showSubCategoryFilter" field="sub_category_name" matchMode="equals">
                                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                                <div class="filterField p-float-label p-input-icon-left">                                                    
                                                    <p-dropdown [ngModel]="value" [options]="productSubCategoryData" optionLabel="sub_category" optionValue="sub_category"
                                                        (onChange)="filter($event.value)" placeholder="Select a Sub Category" [showClear]="true">
                                                    </p-dropdown>
                                                    <i class="pi pi-filter-fill icon"></i>
                                                    <label for="filter1">Sub Category</label>
                                                </div>
                                                
                                            </ng-template>
                                        </p-columnFilter>
                                    </div>
                                    
                                    
                                    <div class="search-box">
                                        <i class="pi pi-search"></i>
                                        <!-- <input pInputText type="text" #filter (input)="filterData(filter.value, 'contains')" placeholder="Search keyword" /> -->
                                        <input pInputText type="text" #filter (input)="allDevicesTable.filterGlobal(filter.value, 'contains')" placeholder="Search" />
                                    </div>                                   
                                </div>
                            </div>                
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <!-- <th>Id</th> -->
                                <th style="width: 150px; min-width:150px; max-width:150px;">Device Name</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Category Name</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Sub Category Name</th>
                                <th style="width: 250px; min-width:250px; max-width:250px;">Available Test Type</th>
                                <!-- <th>Customer Name</th> -->
                                <th style="width: 100px; min-width:100px; max-width:100px;">Status</th>
                                <th style="width: 100px; min-width:100px; max-width:100px;">Valid Till</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Created At</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Last Updated At</th>
                                <th style="width: 120px; min-width:120px; max-width:120px;">Last Updated By</th>
                                <!-- <th style="width: 200px; min-width:200px; max-width:200px;">Comments</th> -->
                                <!-- <th style="width: 110px; min-width: 110px; max-width: 110px;"></th> -->
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-device>
                            <tr (click)="navigateToProductDetails(device)">
                                <!-- <td>{{device.id}}</td> -->
                                <td style="width: 150px; min-width:150px; max-width:150px;" class="td-clr-primary tb-bold">{{device.product_code}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.main_category_name}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.sub_category_name}}</td>
                                <td style="width: 250px; min-width:250px; max-width:250px;" class="testTypesList">
                                    <div class="chip" *ngFor="let test of device.test_types">{{test.name}}</div>
                                    <!-- <button *ngIf="device.test_types.length == 0" type="button" class="testNowBtn" (click)="showGenerateTestcasesDialog(device)">
                                        Generate Test Cases
                                    </button>  -->
                                </td>
                                <td style="width: 100px; min-width:100px; max-width:100px;" class="td-uppercase">{{device.status==true?'Active':'Inactive'}}</td>
                                <td style="width: 100px; min-width:100px; max-width:100px;">{{device.valid_till}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.created_at}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.last_updated_at}}</td>
                                <td style="width: 120px; min-width:120px; max-width:120px;">{{device.last_updated_by_name}}</td>
                                <!-- <td style="width: 200px; min-width:200px; max-width:200px;">{{device.comments}}</td> -->
                                <!-- <td style="width: 110px; min-width: 110px; max-width: 110px;">
                                    <button *ngIf="device.test_types.length != 0" type="button" class="testNowBtn" (click)="showTestDialog(device)">
                                        Test Now
                                    </button>                        
                                </td> -->
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Ready to test Devices">
                <div class="content-loader" *ngIf="readytoTestDevicesLoader">
                    <i class="pi pi-spin pi-spinner"></i>
                    <span>Loading Ready To Test Devices...</span>
                </div>
                <div class="table-container table-selection-list" *ngIf="!readytoTestDevicesLoader">
                    <p-table #readyToTestTable [value]="readyToTestDevices" [globalFilterFields]="['product_code','main_category_name','sub_category','test_types.name','created_at','last_updated_at','last_updated_by_name', 'valid_till', 'comments']">
                        <ng-template pTemplate="caption">
                            <div class="table-title-with-search">
                                <div class="title">                                    
                                        Ready To Test Devices
                                        <div class="count">{{readyToTestDevices.length}}</div>
                                </div>
                                <div class="right-section">
                                    <div class="search-box">
                                        <i class="pi pi-search"></i>
                                        <!-- <input pInputText type="text" #filter (input)="filterData(filter.value, 'contains')" placeholder="Search keyword" /> -->
                                        <input pInputText type="text" #filter (input)="readyToTestTable.filterGlobal(filter.value, 'contains')" placeholder="Search" />
                                    </div>                                   
                                </div>
                            </div>                
                        </ng-template>
                        <ng-template pTemplate="header">
                            <tr>
                                <!-- <th>Id</th> -->
                                <th style="width: 150px; min-width:150px; max-width:150px;">Device Name</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Category Name</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Sub Category Name</th>
                                <th style="width: 250px; min-width:250px; max-width:250px;">Available Test Type</th>
                                <!-- <th>Customer Name</th> -->
                                <th style="width: 100px; min-width:100px; max-width:100px;">Status</th>
                                <th style="width: 100px; min-width:100px; max-width:100px;">Valid Till</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Created At</th>
                                <th style="width: 150px; min-width:150px; max-width:150px;">Last Updated At</th>
                                <th style="width: 120px; min-width:120px; max-width:120px;">Last Updated By</th>
                                <!-- <th style="width: 200px; min-width:200px; max-width:200px;">Comments</th> -->
                                
                                <!-- <th style="width: 110px; min-width: 110px; max-width: 110px;"></th> -->
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-device>
                            <tr (click)="navigateToProductDetails(device)">
                                <!-- <td>{{device.id}}</td> -->
                                <td style="width: 150px; min-width:150px; max-width:150px;" class="td-clr-primary tb-bold">{{device.product_code}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.main_category_name}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.sub_category_name}}</td>
                                <td style="width: 250px; min-width:250px; max-width:250px;" class="testTypesList">
                                    <div class="chip" *ngFor="let test of device.test_types">{{test.name}}</div>
                                    <!-- <button *ngIf="device.test_types.length == 0" type="button" class="testNowBtn" (click)="showGenerateTestcasesDialog(device)">
                                        Generate Test Cases
                                    </button>  -->
                                </td>
                                <td style="width: 100px; min-width:100px; max-width:100px;" class="td-uppercase">{{device.status==true?'Active':'Inactive'}}</td>
                                <td style="width: 100px; min-width:100px; max-width:100px;">{{device.valid_till}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.created_at}}</td>
                                <td style="width: 150px; min-width:150px; max-width:150px;">{{device.last_updated_at}}</td>
                                <td style="width: 120px; min-width:120px; max-width:120px;">{{device.last_updated_by_name}}</td>
                                <!-- <td style="width: 200px; min-width:200px; max-width:200px;">{{device.comments}}</td> -->
                               
                                <!-- <td style="width: 110px; min-width: 110px; max-width: 110px;">
                                    <button type="button" class="testNowBtn" disabled (click)="showTestDialog(device)">
                                        Test Now                                       
                                    </button>                        
                                </td> -->
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>            
        </p-tabView>
    </div>    
</div>